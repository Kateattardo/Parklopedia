<%- include('../partials/nav') %>

<div class="background">
<div class="container-md">
<div class="park-details">
  <% if (park.owner) {%>
      <small>Created by: <%= park.owner.name %></small>
  <% } %>
  <div class="row justify-content-between">
      <article class="col-5 border border-dark">
          <h1><%= park.name %></h1>
          <p><%= park.desc %></p>
          
          <div class="features border border-dark text-center">
              <h6>Features:</h6>
              <ul>
                  <li>Walking Trail: <%= park.walkingTrail ? 'Yes' : 'No' %></li>
                  <li>BBQ/Picnic Area: <%= park.bbqPicnic ? 'Yes' : 'No' %></li>
                  <li>Dog Run: <%= park.dogRun ? 'Yes' : 'No' %></li>
                  <li>Playground: <%= park.playground ? 'Yes' : 'No' %></li>
              </ul>
          </div>

          <% if (park.owner?._id.equals(user?._id)) {%>
              <div class="container-md">
                  <a href="/parks/edit/<%= park._id %>" class="btn btn-info m-3">
                      Edit <%= park.name %>
                  </a>
                  <form action="/parks/<%= park._id %>?_method=DELETE" method="POST">
                      <input type="submit" class="btn btn-danger m-3" value="Delete <%= park.name %>">
                  </form>
              </div>
          <% } %>
      </article>
  </div>
  <hr>
  <% if (user) { %>
      <div class="col-md-6">
          <form action="/comments/<%= park._id %>" method="POST">
              <fieldset>
                  <legend>Add Comment</legend>
                  <label class="form-label">rating:</label>
                  <div class="star-rating">
                    <input type="radio" name="rating" value="1" id="rating1"><label for="rating1" class="fa fa-star"></label>
                    <input type="radio" name="rating" value="2" id="rating2"><label for="rating2" class="fa fa-star"></label>
                    <input type="radio" name="rating" value="3" id="rating3"><label for="rating3" class="fa fa-star"></label>
                    <input type="radio" name="rating" value="4" id="rating4"><label for="rating4" class="fa fa-star"></label>
                    <input type="radio" name="rating" value="5" id="rating5"><label for="rating5" class="fa fa-star"></label>
                  <input class="form-control mb-1" type="number" min="1" max="5"name="rating">
                  <label class="form-label">comment:</label>
                  <input class="form-control mb-1" type="text" name="note">
                  <label class="form-label">topic:</label>
                  <select name="topic">
                    <option value="General" selected>General</option>
                    <option value="Dog runs">Dog run</option>
                    <option value="Playgrounds">Playgrounds</option>
                    <option value="Public restrooms">Public restrooms</option>
                    <option value="Landscaping">Landscaping</option>
                    <option value="Construction">Construction</option>
                  </select>
                  <input type="submit" class="btn btn-success" value="add comment">
              </fieldset>
          </form>
      </div>
    </div>
  <% } %>
  <hr>
  <div class="container-md">
        <% if (park?.comments?.length) { %>
       
          <!-- loop the comments and display -->
          <div class="container-sm m-4">
              <% park.comments.forEach(comm => {%>
                  <div class="card mb-4 shadow">
                      <div class="card-body">
                          <p><%= comm.note %></p>
                          <p><%= comm.rating %></p>
                          <div class="display-rating">
                            <% for(let i = 0; i < comm.rating; i++) { %>
                                <span class="fa fa-star"></span>
                            <% } %>
                            <% for(let i = comm.rating; i < 5; i++) { %>
                                <span class="fa fa-star-o"></span>
                            <% } %>
                        </div>
                          <p><%= comm.topic %></p>
                          <p><%= comm.createdAt.toLocaleString()%></p>
                          <div class="d-flex justify-content-between">
                              <small>owner <%= comm.owner?.name %></small>
                              <% if (user && comm.owner?._id == user.id) { %>
                                  <form action="/comments/<%= park._id%>/<%= comm._id %>?_method=DELETE" method="POST">
                                      <input type="submit" class="btn btn-danger" value="X">
                                  </form>
                              <% } %>
                          </div>
                      </div>
                  </div>
              <% }) %>
          </div>
      <% } else { %>
          <p>No Comments Yet</p>
      <% } %>
  </div>
</div>
</div>
</div>

<%- include('../partials/footer') %>